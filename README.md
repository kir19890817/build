Руководство к системе сборки

0. Для того, чтобы воспользоваться системой сборки, достаточно в папке build 
запустить соответствующую цель:

make <цель>, где <цель>:
 - all (также цель по умолчанию) - сборка под QNX и модульных тестов для соответствующей
   host-платформы;
 - clean - уничтожение собранных файлов под QNX и модульных тестов;
 - mex - сборка s-функций и требущихся для них библиотек;
 - mex_clean - противоположное действие;
 - l, lin, linux - сборка под Linux,
 - linux_clean - противоположное действие;
 - utests - сборка модульных тестов;
 - utests_clean - уничтожение модульных тестов.

1. Головной Makefile рекурсивно запускает сборку в папках, определенных в его переменных:

APPS = testexch testcore
LIBS = libcore libdp libbase libenv libpugi
UTESTLIBS = libbase libpugi cpp_unit_lite
UTESTS = libbase libenv libdp

2. В каждой папке находятся Makefile'ы с расширениями 
 - *.mex - сборка в виде библиотеки или s-функции для последующего использования 
   в MATLAB/Simulink, 
 - *.linux - исполняемый файл или библиотека под Linux,
 - *.qcc - исполняемый файл или библиотека под QNX, 
 - *.nat - исполняемый файл или библиотека для модульных тестов и/или под ту же 
   платформу, под которой совершается сборка. 

В зависимости от цели, в папке явно указывается один из них, например:
linux:
	for i in $(ALL); do $(MAKE) -f Makefile.linux -C ../src/$$i; done

3. Дальнейшая сборка выполняется после перехода в соответствующую папку, поэтому все пути
в соответствующем Makefile'е считаются относительно нее.

4. В Makefile, находящийся в папке с проектом, включаются файлы из соответсвующей данной
целевой платформе папки (например, linux):

DEPTH   = ..

include objects.mk
include $(DEPTH)/../build/linux/librules.mk

Переменная DEPTH определяет, на сколько уровней текущая папка отступает от build. 

5. Внутри основной папки для сборки (linux, qcc, mexw, native) находятся файлы 
common.mk, binrules.mk, librules.mk, objrules.mk

5.1 Файл common.mk настраивает глобальные переменные, используемые в других *.mk, включаемых
в головной в соответствующей папке.

5.2 binrules.mk описывает действия, совершаемые при сборке исполняемого файла.

5.3 librules.mk описывает сценарий сборки библиотеки.

5.4 objrules.mk содержит общие для binrules.mk и librules.mk правила по сборке объектных
файлов.

5.5 Перечисленные файлы могут, в свою очередь, включать соответствующий файл уровнем выше,
если binrules, objrules или librules полностью описывается "шаблоном", находящимся в папке
build.

6. Файл deprules.mk служит для установления зависимостей между *.c, *.cpp - файлами
и соответствующими *.h - файлами и приводит к автоматической генерации *.d-файлов. 
Формат его не зависит от платформы, поэтому он находится в папке build. При этом d-файл
содержит зависимости вида:
../../../tmp/dataproc/libdp.a/obj_qnx/AlphaBeta.o \
../../../tmp/dataproc/libdp.a/dep/AlphaBeta.d :  AlphaBeta.cpp AlphaBeta.h \
 ../../../install/usr/include/libbase/Tools.h \
 ../../../install/usr/include/libbase/MathConsts.h

то есть является полноценным "куском" Makefile'а и может быть в него включен. 
Включение выполняется в binrules.mk и librules.mk
При этом в Makefile'е появляется новая цель без правила, а правила описываются
в objrules, librules или binrules отдельно. Но зависимость остается в силе.

7. Файл common.mk при удачном стечении обстоятельств является единственным, который
нужно менять для создания конфигурации сборки для новой платформы.

Например, для native (по комментариям понятно, что к чему):

# Каталог с исходными кодами
SRC = ../src
# Временное хранилище для объектных файлов
TEMP = ../../tmp/dataproc
# Каталог установки программ
INS = ../../utests
# Каталог компиляции программ
BIN = $(INS)/bin
# Каталог с настроечными файлами
ETC = $(INS)/etc
LIBS = $(INS)/lib
USRINC = $(SRC)
# Операционная система (linux/qnx)
SYS ?= $(shell uname -s | tr A-Z a-z)
# Компилятор C++
CXX = g++ -g
# Флаги компилятора
CXXFLAGS = -I$(DEPTH)/$(USRINC) -I$(DEPTH)/../../install/usr/include
# Программа-архиватор для библиотек
AR = ar
# Расширение объектных файлов
OSUF = o
# Папка, в которую помещаются объектные файлы в TEMP
OBJDIR = obj_nat
# Флаг, обозначающий, что в USRINC заголовочные файлы копировать не нужно
NO_HEADERINS = 1

